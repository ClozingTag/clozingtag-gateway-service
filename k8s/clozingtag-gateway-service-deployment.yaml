apiVersion: v1
kind: Secret
metadata:
  name: clozingtag-gateway-service-secret
data:
  client-secret: "cGVlci5mdW5kaW5nQDIw" #change me
  client-id: "cGVlci5mdW5kaW5n" #change me

---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: clozingtag-gateway-service-deployment
spec:
  replicas: 1
  selector:
    matchLabels:
      app: clozingtag-gateway-service-deployment
  template:
    metadata:
      labels:
        app: clozingtag-gateway-service-deployment
    spec:
      containers:
      - env:
        - name: JAVA_OPTIONS
          value: -XX:TieredStopAtLevel=1 -noverify -Xms128m -Xmx512m -Xss4m -XX:ParallelGCThreads=1
            -XX:ConcGCThreads=1 -Djava.util.concurrent.ForkJoinPool.common.parallelism=1
            -cp .
        - name: DISCOVERY_SERVER_URL
          valueFrom:
            configMapKeyRef:
              name: clozingtag-discovery-service-configmap
              key: discovery-server-url
#        - name: CONFIG_SERVER
#          valueFrom:
#            configMapKeyRef:
#              name: clozingtag-gateway-service-configmap
#              key: config-server-url
        - name: CLIENT_ID
          valueFrom:
            secretKeyRef:
              name: clozingtag-gateway-service-secret
              key: client-id
        - name:  CLIENT_SECRET
          valueFrom:
            secretKeyRef:
              name:  clozingtag-gateway-service-secret
              key:  client-secret
        image: <IMAGE>
        imagePullPolicy: IfNotPresent
        name: clozingtag-gateway-service
        ports:
          - containerPort: 8181
            protocol: TCP
        resources:
          limits:
            cpu: 800m
            memory: 1024Mi
          requests:
            cpu: 400m
            memory: 512Mi

---
apiVersion: v1
kind: Service
metadata:
  name: clozingtag-gateway-service-svc
spec:
  selector:
    app: clozingtag-gateway-service-deployment
  ports:
    - protocol: "TCP"
      port: 8181
      targetPort: 8181
  type: ClusterIP